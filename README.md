# Notes on the current development
put it here at top because I'm the first one who needs to remember what have been done and what have to be finished ðŸ˜œ

- uses argparse to handle arguments and help :
  - --no-subfolder (-ns) argument to put everything in the same folder (default is to create subdirectories).
  - --no-moresplit (-nm) argument to keep the big stylesheet and js files (default is to split those files then delete them).
  - assuming encoding if twee file is utf-8 but an option to specify another encoding.
  - default is to write new files (sections) in utf-8 encoding but an option to force another encoding if necessary.
  - I tried to handle encoding more than that but lost myself. It could uses the chardet library but it seems that it then becomes a dependency the user will have to install to run the script, so the actual code is not that good but the script could run by itself (except for python obviously).
  - --version -v option.
  - --help -h for help.
  - if nothing given, the script prints the help, generated by argparse. Maybe a usage help could be provided, maybe with the epilog option??
<br>

- add some variables at the very top of script, like author, status, etc. The one needed was for the -v --version option, but well, the other ones are here now. Maybe __licence__ needs to be written.
- add an error handling if file given is not a file but a directory.
- add en arror handling if file given doesn't exist.
- need more different twee files for testing!

### Current known bugs
- as coded for now if no output folder is given, output looks like to be in [FolderWithSameNameAsTweeFile] but I ran into an error :
>An error occurred: expected str, bytes or os.PathLike object, not NoneType <br>

For now need more debugging / testing, everything seems to be written, so not sure why and from where this error comes.
__________________________________
# Tweego-File-Splitter
Splits a .twee file up into separate files. By default, a new folder is created to house the split files.

## Purpose
As of the current version (1.3.0) of [Tweego](https://www.motoslave.net/tweego/), decompiling will result in a single large file. However, a large benefit of using Tweego is to be able to organize a Twee game into a folder structure. To convert the single decompiled file into this folder structure requires spending large amounts of times simply creating new files. So having the ability to automatically split large .twee files can help automate this process.

## Usage
From within another python file
```python
import tweego_file_splitter
tweego_file_splitter.splitFile("fileToSplit.twee")
```

From the command line
```
python tweego_file_splitter tweefile [outputDirectory]
```
## Dependencies
* Python 3

## Changelog

### 1.0.1 (Update By Mellerin using Copilot)
- use utf8 as decoding for the script to just work.
- sanitize filenames because sometime passages titles introduce an error with incorrect character in filename / path.
- include subdirectories for special files / sections (SpecialPassages, StoryData, StoryScripts, StyleSheet, Widgets). Please note that it's not an option (yet?) so it writes files under subfolders even if you don't want to.
- include a -help or -? command line option. Well it's not that helpful but should be included, maybe if it will include more options ðŸ˜…

<p>Please note that I'm not a python dev (or whatever a dev), so Copilot was really helpful for me here and to be honest it did almost all the work.<br>
Only tested in commandline mode under windows10 for now and it works. Should also work wherever python could be installed if you can launch a python script.<br>
Not tested : usage from within another python file like described below in the original Readme.md.</p>
<p>Uses re, sys, os, Path from pathlib, Optional from typing.</p>

### 1.0.1b More splitting
- add more splitting in order to split the large 'Story Stylesheet.twee' and 'Story JavaScript.twee' files into individual css rules or js scripts if each sections are properly found using the stylesheet_pattern and script_pattern. The large files are then deleted.

#### About patterns, titles and tags
The script splits the twee file passed in argument based on patterns defined at the beginning, like this :<br>

> passage_pattern = re.compile(r":: (.+)\n((?:(?:.*\n)(?!:: ))*)")
<p>(something like :: PassageTitle [tag1 tag2 ...] )</p>
<br>
Splitting Titles and Tags are defined just below, like this :<br>

>SPECIAL_TITLES = [
>    "PassageDone", "PassageFooter", "PassageHeader", "PassageReady",
>    "StoryBanner", "StoryCaption", "StoryDisplayTitle", "StoryInit",
>    "StoryMenu"
]
>
>STORY_DATA_TITLES = ["StoryData", "StoryTitle"]
>
>TAG_SUBFOLDERS = {
>    'stylesheet': 'StyleSheet',
>    'script': 'StoryScripts',
>    'widget': 'Widgets'
>}
<br>
<p>Just to say that splitting is done with those definitions, so if your twee file is made with other patterns or you want different tags, less or more subfolders you have to modify those sections by yourself inside the code.</p>
<br>
<p>stylesheet_pattern and script_pattern are regex patterns used to split the large Story Stylesheet.twee and Story JavaScript.twee files into individual rules or scripts files, depending on the patterns found.</p>

## Tested With
- Version 1.0.0 tested with Tweego 1.3.0 and Python 3.7.3
- Version 1.0.1 tested with Tweego 2.1.1 and Python 3.7.3
